---
title: "Working with Transactions"
author: "Mustafa Ascha"
date: "September 11, 2016"
output: html_document
	toc:true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

In the last post, we went through the process of simulating some random billing claims data, then putting it through the CSPADE algorithm to see if there were any interesting frequent sequences. 


Before we begin any coding, I'd like to point out that our model will involve considering patients as transactions, and diseases as items. When a patient has a set of diseases, and two of those diseases also occur in many other patients, we'll have an association rule with high "support". For more on understanding association rules, [check out the `arules` package author's document.](http://michael.hahsler.net/research/arules_RUG_2015/demo/) It's a great website, and I highly recommend reading through it. 

## Load libraries, get data

First, of course, we'll have to load some libraries: 

```{r libraries}

library(arules)
library(arulesViz)
library(dplyr)
library(ggplot2)

```

Here's how to make the data we'll use. 

Because this is a simulation, there will be some randomness involved. To make sure you can replicate everything, we'll set a seed: 

```{r set_seed}

set.seed(9001)

```

Making the list of diseases became meditative for me, so I may have added a bit many. Either way, we'll use that to make a dataframe with five patients. 

```{r sim_data}

diseases <- 
	c("Heart disease",
	  "Hypertension",
	  "Kidney disease",
	  "Liver cirrhosis",
	  "Gall stones",
	  "Kidney stones",
	  "Tonsiliths",
	  "Unspecified cancer",
	  "Vitamin D deficiency",
	  "Trichtillomania",
	  "Psoriasis",
	  "Esophagitis",
	  "Otitis media",
	  "Ingrown toenail",
	  "ADHD",
	  "Arthritis",
	  "Chlamydia",
	  "Parasites Scabies",
	  "Meningitis",
	  "Zika Virus",
	  "Hepatitis",
	  "Giardiasis",
	  "Takatsubo Cardiomyopathy",
	  "Flu",
	  "Obesity",
	  "Latex allergies",
	  "Lice",
	  "Legionellosis",
	  "Lymphocytic Choriomeningitis",
	  "Tetanus",
	  "Ticks - Lyme Disease",
	  "Tuburculosis",
	  "Trench fever",
	  "Creutzfeldt-Jakob Disease",
	  "Hearing loss")

claims_data <- 
	data.frame(disease = sample(diseases, 50, replace = TRUE), 
		   patient = rep_len(1:5, 50))

```


I'll be artificially adding "Hypertension" and "Kidney disease" to several of the patients, just to make sure arules works. The following code adds the diagnoses to patients 1 and 2. This works because patients in the above dataframe were constructed using `rep_len`, which simply repeats the numbers 1 through 5 as many times as we ask. 

```{r add_diseases}

claims_data$disease[c(1:2 * 5, (1:2 * 5) + 1),] <- "Hypertension"


claims_data$disease[c(3:4 * 5, (3:4 * 5) + 1),] <- "Kidney disease"

```


## Run arules


## Plot some data


## Calculate and examine interesting measures

This is healthcare data, so we'll look at tests of difference and odds ratios. 

## 

Alright, so let's see what data is available to visualize. I'll just be exploring, here, so let's start with checking out what methods are available for the `rules` class: 

```{r check_methods}

methods(class = "rules")

```





















